<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="csrf-token" content="{{ csrf_token() }}">
  <title data-i18n="cc_title">–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä ‚Äî Map v12</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_common.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin_panel.css') }}">
</head>
<body class="light theme-blue admin">
  <header class="ap-header">
    <div class="ap-brand">
      <span class="ap-brand__logo">üß≠</span>
      <div>
        <div class="ap-brand__title" data-i18n="cc_brand">–ö–æ–º–∞–Ω–¥–Ω—ã–π —Ü–µ–Ω—Ç—Ä</div>
        <div class="ap-brand__sub muted"><span data-i18n="cc_server_time">–≤—Ä–µ–º—è —Å–µ—Ä–≤–µ—Ä–∞:</span> <span id="server-time">‚Äî</span></div>
      </div>
    </div>

    <div class="ap-search">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input id="ap-search" class="input" placeholder="–ü–æ–∏—Å–∫: –Ω–∞—Ä—è–¥ / TG ID / –∑–∞—è–≤–∫–∞ #‚Ä¶" data-i18n-placeholder="cc_search_ph">
      <button id="ap-search-btn" class="btn" type="button"><i class="fa-solid fa-magnifying-glass"></i> <span class="lbl" data-i18n="cc_btn_find">–ù–∞–π—Ç–∏</span></button>
    </div>

    <div class="ap-actions">
      <button id="ap-toggle-sidebar" class="btn" type="button" title="–°–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å –ø–∞–Ω–µ–ª—å"><i class="fa-solid fa-bars"></i></button>

      <button id="ap-toggle-tools" class="btn ap-hide-mobile" type="button" title="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å KPI –∏ —Ñ–∏–ª—å—Ç—Ä—ã">
        <i class="fa-solid fa-sliders"></i> <span class="lbl"><span data-i18n="cc_btn_panel">–ü–∞–Ω–µ–ª—å</span></span>
      </button>

      <button id="btn-pair-code" class="btn ap-hide-mobile" type="button" title="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏ —Ç—Ä–µ–∫–µ—Ä–∞">
        <i class="fa-solid fa-link"></i> <span class="lbl"><span data-i18n="cc_btn_code">–ö–æ–¥</span></span>
      </button>

      <button id="btn-chat" class="btn ap-hide-mobile" type="button" title="–ß–∞—Ç">
        <i class="fa-solid fa-comments"></i> <span class="lbl"><span data-i18n="cc_btn_chat">–ß–∞—Ç</span></span>
        <span id="btn-chat-unread" class="ap-badge red" style="display:none; margin-left:6px;">0</span>
      </button>

      <button id="btn-incidents-layer" class="btn ap-hide-mobile" type="button" title="–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ" aria-pressed="false">
        <i class="fa-solid fa-triangle-exclamation"></i> <span class="lbl">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</span>
      </button>
      <!-- –≠—Ç–∞–ø 2: —Å–ª–æ–π –æ–±—ä–µ–∫—Ç–æ–≤ + –±—ã—Å—Ç—Ä–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ -->
      <button id="btn-objects-layer" class="btn ap-hide-mobile" type="button" title="–û–±—ä–µ–∫—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ" aria-pressed="false">
        <i class="fa-solid fa-location-dot"></i> <span class="lbl">–û–±—ä–µ–∫—Ç—ã</span>
      </button>
      <button id="btn-object-add" class="btn ap-hide-mobile" type="button" title="–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç –Ω–∞ –∫–∞—Ä—Ç–µ" data-mode="incident">
        <i class="fa-solid fa-plus"></i> <span class="lbl">–ò–Ω—Ü–∏–¥–µ–Ω—Ç</span>
      </button>

      <a id="ap-service-link" class="btn ap-hide-mobile" href="/admin/service" title="–°–ª—É–∂–±–∞: –∑–∞—è–≤–∫–∏ –∏ –ø—Ä–∏–≤—è–∑–∫–∞">
        <i class="fa-solid fa-shield-halved"></i> <span class="lbl"><span data-i18n="cc_btn_service">–°–ª—É–∂–±–∞</span></span>
        <span id="svc-pending-badge" class="ap-badge red" style="display:none; margin-left:6px;">0</span>
      </a>

      <a class="btn ap-hide-mobile" href="/" title="–ù–∞ –∫–∞—Ä—Ç—É"><i class="fa-solid fa-map"></i> <span class="lbl"><span data-i18n="cc_btn_map">–ö–∞—Ä—Ç–∞</span></span></a>
      <a class="btn ap-hide-mobile" href="/admin/devices" title="–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ —Ç—Ä–µ–∫–µ—Ä–∞"><i class="fa-solid fa-mobile-screen"></i> <span class="lbl"><span data-i18n="cc_btn_devices">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</span></span></a>
      <a class="btn ap-hide-mobile" href="/admin/problems" title="–ü—Ä–æ–±–ª–µ–º—ã/–∞–ª—ë—Ä—Ç—ã —Ç—Ä–µ–∫–µ—Ä–∞"><i class="fa-solid fa-triangle-exclamation"></i> <span class="lbl"><span data-i18n="cc_btn_problems">–ü—Ä–æ–±–ª–µ–º—ã</span></span></a>
      <a class="btn ap-hide-mobile" href="/admin/metrics" title="–ú–µ—Ç—Ä–∏–∫–∏/–º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"><i class="fa-solid fa-chart-line"></i> <span class="lbl"><span data-i18n="cc_btn_metrics">–ú–µ—Ç—Ä–∏–∫–∏</span></span></a>

      <button id="ap-refresh" class="btn primary" type="button" title="–û–±–Ω–æ–≤–∏—Ç—å"><i class="fa-solid fa-rotate"></i></button>

      <button id="ap-lang" class="btn ap-hide-mobile" type="button" data-i18n-title="common_language" title="–Ø–∑—ã–∫">
        <i class="fa-solid fa-language"></i> <span id="ap-lang-label">RU</span>
      </button>
      <button id="ap-theme" class="btn ap-hide-mobile" type="button" data-i18n-title="common_theme" title="–¢–µ–º–∞">
        <i class="fa-solid fa-circle-half-stroke"></i>
      </button>

      <button id="ap-more" class="btn ap-show-mobile" type="button" title="–ï—â—ë"><i class="fa-solid fa-ellipsis-vertical"></i></button>
      <div id="ap-more-menu" class="dropdown-menu">
        <button class="dropdown-item" type="button" data-act="toggleTools"><i class="fa-solid fa-sliders"></i> –ü–∞–Ω–µ–ª—å KPI/—Ñ–∏–ª—å—Ç—Ä—ã</button>
        <button class="dropdown-item" type="button" data-act="pair"><i class="fa-solid fa-link"></i> –ö–æ–¥ –ø—Ä–∏–≤—è–∑–∫–∏</button>
        <button class="dropdown-item" type="button" data-act="chat"><i class="fa-solid fa-comments"></i><span data-i18n="cc_btn_chat">–ß–∞—Ç</span></button>
        <button class="dropdown-item" type="button" data-act="incidentAdd"><i class="fa-solid fa-plus"></i> –ò–Ω—Ü–∏–¥–µ–Ω—Ç</button>
        <button class="dropdown-item" type="button" data-act="objectAdd"><i class="fa-solid fa-plus"></i> –û–±—ä–µ–∫—Ç</button>
        <a class="dropdown-item" href="/admin/service"><i class="fa-solid fa-shield-halved"></i><span data-i18n="cc_btn_service">–°–ª—É–∂–±–∞</span><span id="svc-pending-badge-mobile" class="ap-badge red" style="display:none; margin-left:8px;">0</span></a>
        <a class="dropdown-item" href="/"><i class="fa-solid fa-map"></i> –ù–∞ –∫–∞—Ä—Ç—É</a>
        <a class="dropdown-item" href="/admin/devices"><i class="fa-solid fa-mobile-screen"></i><span data-i18n="cc_btn_devices">–£—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</span></a>
        <a class="dropdown-item" href="/admin/problems"><i class="fa-solid fa-triangle-exclamation"></i><span data-i18n="cc_btn_problems">–ü—Ä–æ–±–ª–µ–º—ã</span></a>
        <a class="dropdown-item" href="/admin/metrics"><i class="fa-solid fa-chart-line"></i><span data-i18n="cc_btn_metrics">–ú–µ—Ç—Ä–∏–∫–∏</span></a>
        <div class="dropdown-sep"></div>
        <button class="dropdown-item" type="button" data-act="theme"><i class="fa-solid fa-circle-half-stroke"></i> <span data-i18n="common_theme">–¢–µ–º–∞</span></button>
        <button class="dropdown-item" type="button" data-act="lang"><i class="fa-solid fa-language"></i> <span data-i18n="common_language">–Ø–∑—ã–∫</span></button>
      </div>
    </div>
  </header>

  <div id="ap-alertbar" class="ap-alertbar" style="display:none"></div>

  <div class="ap-layout">
    <aside class="ap-sidebar">

      <!-- –≠—Ç–∞–ø 3.1: —Ç–∞–±—ã –ª–µ–≤–æ–π –ø–∞–Ω–µ–ª–∏ (–û–±—ä–µ–∫—Ç—ã —Å –∫–∞–º–µ—Ä–∞–º–∏ / –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã).
           –í–∫–ª–∞–¥–∫–∞ "–ù–∞—Ä—è–¥—ã" —É–±—Ä–∞–Ω–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é: –±–ª–æ–∫ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ DOM (hidden), —á—Ç–æ–±—ã –Ω–µ –ª–æ–º–∞—Ç—å –º–æ–¥—É–ª–∏ CC,
           –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—á—ë—Ç—á–∏–∫–∏/—Ñ–∏–ª—å—Ç—Ä—ã —Å–º–µ–Ω. -->
      <div class="ap-sidebar-tabs" role="tablist" aria-label="–†–∞–∑–¥–µ–ª—ã">
        <button class="ap-stab active" type="button" data-stab="objects" role="tab" aria-selected="true">
          <span class="ap-stab__label">–û–±—ä–µ–∫—Ç—ã —Å –∫–∞–º–µ—Ä–∞–º–∏</span>
          <span class="ap-stab__badges">
            <span class="ap-badge" id="tab-objects-badge">0</span>
          </span>
        </button>
        <button class="ap-stab" type="button" data-stab="incidents" role="tab" aria-selected="false">
          <span class="ap-stab__label">–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</span>
          <span class="ap-stab__badges">
            <span class="ap-badge" id="tab-incidents-badge">0</span>
            <span class="ap-badge red ap-stab__unread" id="tab-incidents-unread" style="display:none">0</span>
          </span>
        </button>
      </div>

      <div class="ap-sidebar-pane" data-spane="units" role="tabpanel" hidden>

      <section class="ap-card">
        <div class="ap-card__head">
          <div class="ap-card__title"><i class="fa-solid fa-person-military-pointing"></i> <span data-i18n="cc_sidebar_active">–ê–∫—Ç–∏–≤–Ω—ã–µ –Ω–∞—Ä—è–¥—ã</span></div>
          <div class="ap-badges">
            <span class="ap-badge" id="count-shifts">0</span>
          </div>
        </div>
        <div class="ap-filter">
          <label class="ap-filter__item"><input type="checkbox" id="flt-live"> <span data-i18n="cc_flt_live">—Ç–æ–ª—å–∫–æ –≤ —ç—Ñ–∏—Ä–µ</span></label>
          <label class="ap-filter__item"><input type="checkbox" id="flt-break"> <span data-i18n="cc_flt_break">—Å –æ–±–µ–¥–æ–º</span></label>
          <label class="ap-filter__item"><input type="checkbox" id="flt-sos"> <span data-i18n="cc_flt_sos">—Å SOS</span></label>
          <label class="ap-filter__item"><input type="checkbox" id="flt-stale"> <span data-i18n="cc_flt_stale">–Ω–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π &gt; 5 –º–∏–Ω</span></label>
        </div>
        <div id="critical-now" class="ap-critical" style="display:none"></div>
        <div id="list-shifts" class="ap-card__body muted"><span data-i18n="cc_loading">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span></div>
      </section>

      <section class="ap-card">
        <div class="ap-card__head">
          <div class="ap-card__title"><i class="fa-solid fa-burger"></i> <span data-i18n="cc_sidebar_breaks">–û–±–µ–¥—ã</span></div>
          <div class="ap-badges"><span class="ap-badge" id="count-breaks">0</span></div>
        </div>
        <div id="list-breaks" class="ap-card__body muted">‚Äî</div>
      </section>

      <section class="ap-card ap-card--danger">
        <div class="ap-card__head">
          <div class="ap-card__title"><i class="fa-solid fa-triangle-exclamation"></i> <span data-i18n="cc_sidebar_sos">SOS</span></div>
          <div class="ap-badges"><span class="ap-badge ap-badge--danger" id="count-sos">0</span></div>
        </div>
        <div id="list-sos" class="ap-card__body muted">‚Äî</div>
        <div class="ap-card__foot muted"><span data-i18n="cc_sidebar_sos_hint">–ù–æ–≤—ã–µ SOS –≤—Å–ø–ª—ã–≤–∞—é—Ç –ø–æ–≤–µ—Ä—Ö —ç–∫—Ä–∞–Ω–∞. –ö–ª–∏–∫ –ø–æ –∑–∞–ø–∏—Å–∏ ‚Äî —Ñ–æ–∫—É—Å –Ω–∞ –∫–∞—Ä—Ç–µ.</span></div>
      </section>

      <section class="ap-card">
        <div class="ap-card__head">
          <div class="ap-card__title"><i class="fa-solid fa-bell"></i> <span data-i18n="cc_sidebar_pending">–ó–∞—è–≤–∫–∏ (pending)</span></div>
          <div class="ap-badges"><span class="ap-badge" id="count-pending">0</span></div>
        </div>
        <div id="list-pending" class="ap-card__body muted">‚Äî</div>
        <div class="ap-card__foot muted"><span data-i18n="cc_sidebar_pending_hint">–°–æ–≤–µ—Ç: –æ–¥–æ–±—Ä–µ–Ω–∏–µ —Å—Ä–∞–∑—É —Å–æ–∑–¥–∞—ë—Ç –º–µ—Ç–∫—É –Ω–∞ –æ—Å–Ω–æ–≤–Ω–æ–π –∫–∞—Ä—Ç–µ.</span></div>
      </section>

      <section class="ap-card ap-card--hint">
        <div class="ap-card__head">
          <div class="ap-card__title"><i class="fa-solid fa-lightbulb"></i> <span data-i18n="cc_sidebar_tips">–ë—ã—Å—Ç—Ä—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏</span></div>
        </div>
        <div class="ap-card__body muted" style="line-height:1.35">
          ‚Ä¢ –ö–ª–∏–∫ –ø–æ –º–µ—Ç–∫–µ –Ω–∞—Ä—è–¥–∞ ‚Üí –¥–µ—Ç–∞–ª–∏ —Ç—Ä–µ–∫–∞/—Å—Ç–æ—è–Ω–æ–∫.<br>
          ‚Ä¢ –ö–Ω–æ–ø–∫–∞ ¬´–ù–∞–ø–∏—Å–∞—Ç—å¬ª –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —á–∞—Ç —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.<br>
          ‚Ä¢ –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è live‚Äë—Ç—Ä–µ–∫–∏–Ω–≥–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è SVG‚Äë—Å–Ω–∏–º–æ–∫ –º–∞—Ä—à—Ä—É—Ç–∞.<br>
          ‚Ä¢ –î–ª—è ¬´–¥–µ–∂—É—Ä–∏—Ç/–Ω–µ –¥–µ–∂—É—Ä–∏—Ç¬ª –æ—Ä–∏–µ–Ω—Ç–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ ¬´—Å—Ç–æ—è–Ω–∫–∏¬ª (R‚âà5‚Äì10–º).
        </div>
      </section>

      </div> <!-- /units pane (hidden) -->

      <div class="ap-sidebar-pane" data-spane="incidents" role="tabpanel" hidden>
        <section class="ap-card" id="ap-incidents-card">
          <div class="ap-card__head">
            <div class="ap-card__title"><i class="fa-solid fa-triangle-exclamation"></i> –ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã</div>
            <div class="ap-badges"><span class="ap-badge" id="count-incidents">0</span></div>
          </div>
          <div class="ap-filter" style="grid-template-columns: 1fr 160px auto; gap:8px">
            <input id="ap-incidents-q" class="input" placeholder="–ü–æ–∏—Å–∫ (–∞–¥—Ä–µ—Å/–æ–ø–∏—Å–∞–Ω–∏–µ)">
            <select id="ap-incidents-status" class="input" title="–§–∏–ª—å—Ç—Ä —Å—Ç–∞—Ç—É—Å–∞">
              <option value="active" selected>–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
              <option value="new">new</option>
              <option value="assigned">assigned</option>
              <option value="enroute">enroute</option>
              <option value="on_scene">on_scene</option>
              <option value="resolved">resolved</option>
              <option value="closed">closed</option>
              <option value="all">–í—Å–µ</option>
            </select>
            <div style="display:flex; gap:6px; justify-content:flex-end">
              <button id="ap-incidents-refresh" class="btn" type="button" title="–û–±–Ω–æ–≤–∏—Ç—å"><i class="fa-solid fa-rotate"></i></button>
              <a class="btn" href="/admin/incidents" title="–û—Ç–∫—Ä—ã—Ç—å –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫"><i class="fa-solid fa-list"></i></a>
            </div>
          </div>
          <div id="list-incidents" class="ap-card__body muted">‚Äî</div>
          <div class="ap-card__foot muted">–ö–ª–∏–∫ –ø–æ –∑–∞–ø–∏—Å–∏: –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É. ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª —Ñ–æ–∫—É—Å–∏—Ä—É–µ—Ç –∫–∞—Ä—Ç—É –∏ –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–æ–π.</div>
        </section>
      </div>

      <div class="ap-sidebar-pane active" data-spane="objects" role="tabpanel">
        <!-- –≠—Ç–∞–ø 2.4: Command Center ‚Äî –ø–∞–Ω–µ–ª—å –æ–±—ä–µ–∫—Ç–æ–≤ (—Å–ø–∏—Å–æ–∫ + —Ñ–∏–ª—å—Ç—Ä—ã + –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ) -->
        <section class="ap-card" id="ap-objects-card">
          <div class="ap-card__head">
            <div class="ap-card__title"><i class="fa-solid fa-location-dot"></i> –û–±—ä–µ–∫—Ç—ã —Å –∫–∞–º–µ—Ä–∞–º–∏</div>
            <div class="ap-badges"><span class="ap-badge" id="count-objects">0</span></div>
          </div>
          <div class="ap-filter" style="grid-template-columns: 1fr 110px auto; gap:8px">
            <input id="ap-objects-q" class="input" placeholder="–ü–æ–∏—Å–∫ (–∞–¥—Ä–µ—Å/–æ–ø–∏—Å–∞–Ω–∏–µ)">
            <input id="ap-objects-tag" class="input" placeholder="–¢–µ–≥">
            <div style="display:flex; gap:6px; justify-content:flex-end">
              <button id="ap-objects-refresh" class="btn" type="button" title="–û–±–Ω–æ–≤–∏—Ç—å"><i class="fa-solid fa-rotate"></i></button>
              <button id="ap-objects-add" class="btn primary" type="button" title="–î–æ–±–∞–≤–∏—Ç—å"><i class="fa-solid fa-plus"></i></button>
              <a class="btn" href="/admin/objects" title="–û—Ç–∫—Ä—ã—Ç—å —Ç–∞–±–ª–∏—Ü—É –æ–±—ä–µ–∫—Ç–æ–≤"><i class="fa-solid fa-table"></i></a>
            </div>
          </div>
          <div id="list-objects" class="ap-card__body muted"><span data-i18n="cc_loading">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</span></div>
          <div class="ap-card__foot muted">–°–æ–≤–µ—Ç: ¬´–ü–æ–∫–∞–∑–∞—Ç—å¬ª –≤–∫–ª—é—á–∏—Ç —Å–ª–æ–π –∏ –æ—Ç–∫—Ä–æ–µ—Ç –ø–æ–ø–∞–ø –Ω–∞ –∫–∞—Ä—Ç–µ.</div>
        </section>
      </div>

    </aside>

    <main class="ap-main">

<div id="ap-overlay" class="ap-overlay">
  <div id="ap-kpi" class="ap-kpi">
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_shifts">–ù–∞—Ä—è–¥—ã</div><div class="ap-kpi__val" id="kpi-shifts">0</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_live">–í —ç—Ñ–∏—Ä–µ</div><div class="ap-kpi__val" id="kpi-live">0</div></div>
          <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_breaks">–û–±–µ–¥—ã</div><div class="ap-kpi__val" id="kpi-breaks">0</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl"><span data-i18n="cc_btn_problems">–ü—Ä–æ–±–ª–µ–º—ã</span></div><div class="ap-kpi__val" id="kpi-problems">0</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_sos">SOS</div><div class="ap-kpi__val" id="kpi-sos">0</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_stale">–ù–µ—Ç —Å–≤—è–∑–∏</div><div class="ap-kpi__val" id="kpi-stale">0</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_acc">–¢–æ—á–Ω–æ—Å—Ç—å</div><div class="ap-kpi__val" id="kpi-acc">‚Äî</div></div>
    <div class="ap-kpi__item"><div class="ap-kpi__lbl" data-i18n="cc_kpi_queue">–û—á–µ—Ä–µ–¥—å</div><div class="ap-kpi__val" id="kpi-queue">0</div></div>
  </div>

  <div id="ap-quickfilters" class="ap-quickfilters" aria-label="–ë—ã—Å—Ç—Ä—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã">
    <button class="ap-chip active" type="button" data-qf="all"><span class="ap-chip__lbl" data-i18n="cc_qf_all">–í—Å–µ</span> <span class="ap-chip__count" id="qf-all">0</span></button>
    <button class="ap-chip" type="button" data-qf="live"><span class="ap-chip__lbl" data-i18n="cc_qf_live">–í —ç—Ñ–∏—Ä–µ</span> <span class="ap-chip__count" id="qf-live">0</span></button>
    <button class="ap-chip" type="button" data-qf="problems"><span data-i18n="cc_btn_problems">–ü—Ä–æ–±–ª–µ–º—ã</span><span class="ap-chip__count" id="qf-problems">0</span></button>
    <button class="ap-chip" type="button" data-qf="sos"><span class="ap-chip__lbl" data-i18n="cc_qf_sos">SOS</span> <span class="ap-chip__count" id="qf-sos">0</span></button>
    <button class="ap-chip" type="button" data-qf="stale"><span class="ap-chip__lbl" data-i18n="cc_qf_stale">–ù–µ—Ç —Å–≤—è–∑–∏</span> <span class="ap-chip__count" id="qf-stale">0</span></button>
    <button class="ap-chip" type="button" data-qf="revoked"><span class="ap-chip__lbl" data-i18n="cc_qf_revoked">–û—Ç–æ–∑–≤–∞–Ω–æ</span> <span class="ap-chip__count" id="qf-revoked">0</span></button>
  </div>
</div>

<div id="ap-empty" class="ap-empty" style="display:none">
  <div class="ap-empty__title">–°–µ–π—á–∞—Å –ø—É—Å—Ç–æ</div>
  <div class="ap-empty__text muted">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Ä—è–¥–æ–≤/SOS/–æ–±–µ–¥–æ–≤. –î–ª—è —Ç–µ—Å—Ç–∞: –≤ –±–æ—Ç–µ –Ω–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å —Å–ª—É–∂–±—É¬ª ‚Üí –æ—Ç–ø—Ä–∞–≤—å—Ç–µ live-–ª–æ–∫–∞—Ü–∏—é, –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ SOS.</div>
</div>

<div id="map" class="ap-map"></div>
      <!-- Right drawer: –∫–∞—Ä—Ç–æ—á–∫–∞ –Ω–∞—Ä—è–¥–∞ -->
      <div id="ap-drawer" class="ap-drawer" aria-hidden="true">
        <div class="ap-drawer__head">
          <div class="ap-drawer__title">
            <div id="drawer-title" class="ap-drawer__title-main">–ù–∞—Ä—è–¥</div>
            <div id="drawer-sub" class="ap-drawer__title-sub muted">‚Äî</div>
          </div>
          <div class="ap-drawer__head-actions">
            <button id="drawer-pan" class="btn" type="button" title="–ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞ –∫–∞—Ä—Ç–µ"><i class="fa-solid fa-location-crosshairs"></i></button>
            <button id="drawer-chat" class="btn has-badge" type="button" title="–ù–∞–ø–∏—Å–∞—Ç—å"><i class="fa-solid fa-comments"></i><span id="drawer-chat-badge" class="ap-badge red btn-badge" style="display:none"></span></button>
            <button id="drawer-copy" class="btn" type="button" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"><i class="fa-solid fa-copy"></i></button>
            <button id="drawer-device" class="btn" type="button" title="–û—Ç–∫—Ä—ã—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ"><i class="fa-solid fa-mobile-screen"></i></button>
            <button id="drawer-close" class="btn minimal" type="button" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
          </div>
        </div>

        <div class="ap-drawer__tabs">
          <button class="ap-tab active" data-tab="overview" type="button"><span data-i18n="cc_tab_overview">–û–±–∑–æ—Ä</span></button>
          <button class="ap-tab" data-tab="track" type="button"><span data-i18n="cc_tab_track">–ú–∞—Ä—à—Ä—É—Ç</span></button>
          <button class="ap-tab" data-tab="journal" type="button"><span data-i18n="cc_tab_journal">–ñ—É—Ä–Ω–∞–ª</span></button>
        </div>

        <div class="ap-drawer__body">
          <div class="ap-pane" data-pane="overview"></div>
          <div class="ap-pane" data-pane="track" style="display:none"></div>
          <div class="ap-pane" data-pane="journal" style="display:none"></div>
        </div>
      </div>
      <div id="toast" class="ap-toast"></div>
    </main>
  </div>

  <!-- Chat modal (–∫–∞–∫ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ) -->
  <div id="chat-backdrop" class="backdrop">
    <div class="modal chat">
      <div class="modal-head">
        <b><span data-i18n="cc_btn_chat">–ß–∞—Ç</span></b>
        <button id="chat-close" class="btn minimal" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body chat-body">
        <div class="chat-list">
          <div class="chat-list-controls">
            <input id="chat-search" class="input chat-search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∏–∫—É –∏–ª–∏ ID">
            <label class="chat-unread-only">
              <input type="checkbox" id="chat-only-unread">
              –¢–æ–ª—å–∫–æ —Å –Ω–æ–≤—ã–º–∏
            </label>
          </div>
          <div class="chat-list-body"></div>
        </div>
        <div class="chat-dialog">
          <div class="chat-dialog-head">
            <div class="chat-peer">
              <span id="chat-peer-name" class="chat-username muted">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ª–æ–≥ —Å–ª–µ–≤–∞</span>
              <span id="chat-peer-id" class="chat-peer-id muted"></span>
            </div>
            <div class="chat-status-wrap">
              <label class="chat-status-label muted">
                –°—Ç–∞—Ç—É—Å:
                <select id="chat-status" class="chat-status-select">
                  <option value="new">–ù–æ–≤—ã–π</option>
                  <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
                  <option value="closed">–ó–∞–∫—Ä—ã—Ç</option>
                </select>
              </label>
            </div>
            <button id="chat-clear" class="btn minimal" type="button" title="–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞">üóë</button>
          </div>
          <div class="chat-messages"></div>
          <div class="chat-input">
            <input id="chat-input-field" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" class="input">
            <button id="chat-send" class="btn primary" type="button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
          </div>
        </div>
    </div>

  <!-- Chat2 modal: —á–∞—Ç –ø–æ —Å–º–µ–Ω–µ (Shift Chat) -->
  <div id="chat2-backdrop" class="backdrop" style="display:none">
    <div class="modal chat2">
      <div class="modal-head">
        <b id="chat2-title">–ß–∞—Ç —Å–º–µ–Ω—ã</b>
        <button id="chat2-close" class="btn minimal" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body chat-body chat2-body">
        <!-- –ò—Å—Ç–æ—Ä–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π -->
        <div id="chat2-messages" class="chat2-messages" style="flex:1; overflow-y:auto; min-height:200px; padding:6px;"></div>
        <!-- –®–∞–±–ª–æ–Ω—ã -->
        <div id="chat2-templates" class="chat2-templates" style="display:flex; flex-wrap:wrap; gap:4px; margin:4px 0;"></div>
        <!-- –í–≤–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ -->
        <div class="chat2-input" style="display:flex; gap:4px;">
          <input id="chat2-input-field" class="input" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ‚Ä¶" style="flex:1">
          <button id="chat2-send" class="btn primary" type="button">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Chat2 channel list modal: —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ -->
  <div id="chat2-list-backdrop" class="backdrop" style="display:none">
    <div class="modal chat2-list">
      <div class="modal-head">
        <b id="chat2-list-title">–ß–∞—Ç—ã</b>
        <button id="chat2-list-close" class="btn minimal" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body chat2-list-body" style="max-height:60vh; overflow-y:auto; padding:6px;">
        <!-- –ü–æ–ª–µ –ø–æ–∏—Å–∫–∞ –ø–æ —Å–ø–∏—Å–∫—É —á–∞—Ç–æ–≤ -->
        <input id="chat2-search" class="input" type="text" placeholder="–ü–æ–∏—Å–∫‚Ä¶" style="width:100%; margin-bottom:6px;">
        <!-- –§–∏–ª—å—Ç—Ä: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∞–Ω–∞–ª—ã —Å –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ -->
        <label style="display:block; margin-bottom:8px; font-size:0.9rem; user-select:none;">
          <input id="chat2-filter-unread" type="checkbox" style="margin-right:4px;">
          –¢–æ–ª—å–∫–æ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã–µ
        </label>
        <div id="chat2-channel-list"></div>
      </div>
    </div>
  </div>



  <!-- –≠—Ç–∞–ø 2.2: –º–æ–¥–∞–ª–∫–∞ ¬´–ò–Ω—Ü–∏–¥–µ–Ω—Ç¬ª (—Ç–æ—á–∫–∞ + –∞–¥—Ä–µ—Å + –æ–ø–∏—Å–∞–Ω–∏–µ + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç/—Å—Ç–∞—Ç—É—Å) -->
    <div id="incident-backdrop" class="backdrop" style="display:none">
      <div class="modal" style="width:min(620px,96vw)">
        <div class="modal-head">
          <b id="incident-modal-title">–î–æ–±–∞–≤–∏—Ç—å –∏–Ω—Ü–∏–¥–µ–Ω—Ç</b>
          <button id="incident-modal-close" class="btn minimal" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
        </div>
        <div class="modal-body">
          <div>
            <label class="muted small">–ê–¥—Ä–µ—Å</label>
            <div style="display:flex; gap:8px; align-items:center">
              <input id="inc-address" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞ 10" style="flex:1" />
              <button id="inc-geocode" class="btn" type="button" title="–ù–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ –∞–¥—Ä–µ—Å—É">–ù–∞–π—Ç–∏</button>
            </div>
          </div>

          <input id="inc-lat" type="hidden" />
          <input id="inc-lon" type="hidden" />

          <div style="margin-top: 10px">
            <label class="muted small">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="inc-desc" class="input" rows="3" placeholder="–ß—Ç–æ –ø—Ä–æ–∏–∑–æ—à–ª–æ / —á—Ç–æ –≤–∞–∂–Ω–æ"></textarea>
          </div>

          <div class="actions" style="margin-top: 14px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap">
            <div class="muted small" style="display:flex; align-items:center">
              –ü–æ–¥—Å–∫–∞–∑–∫–∞: –Ω–∞–∂–º–∏—Ç–µ ¬´–ò–Ω—Ü–∏–¥–µ–Ω—Ç¬ª, –∑–∞—Ç–µ–º –∫–ª–∏–∫ –ø–æ –∫–∞—Ä—Ç–µ. –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–æ—á–∫–∏, –Ω–µ –∏–∑ —Ü–µ–Ω—Ç—Ä–∞.
            </div>
            <div style="display:flex; gap:8px; margin-left:auto">
              <button id="inc-cancel" class="btn" type="button">–û—Ç–º–µ–Ω–∞</button>
              <button id="inc-save" class="btn primary" type="button">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
          </div>

        </div>
      </div>
    </div>

  <div id="object-backdrop" class="backdrop">
    <div class="modal" style="width:min(860px,96vw)">
      <div class="modal-head">
        <b id="object-modal-title">–û–±—ä–µ–∫—Ç</b>
        <button id="object-modal-close" class="btn minimal" title="–ó–∞–∫—Ä—ã—Ç—å">‚úï</button>
      </div>
      <div class="modal-body">
        <div class="grid" style="grid-template-columns: 1.2fr 0.8fr 0.8fr; gap: 8px; align-items:end">
          <div>
            <label class="muted small">–ê–¥—Ä–µ—Å/–Ω–∞–∑–≤–∞–Ω–∏–µ</label>
            <div style="display:flex; gap:8px; align-items:center">
              <input id="obj-name" class="input" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É–ª. –õ–µ–Ω–∏–Ω–∞ 10" style="flex:1" />
              <button id="obj-geocode" class="btn" type="button" title="–ù–∞–π—Ç–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –ø–æ –∞–¥—Ä–µ—Å—É">–ù–∞–π—Ç–∏</button>
            </div>
          </div>
          <div>
            <label class="muted small">Lat</label>
            <input id="obj-lat" class="input" placeholder="53.900000" />
          </div>
          <div>
            <label class="muted small">Lon</label>
            <input id="obj-lon" class="input" placeholder="27.566667" />
          </div>
        </div>

        <div class="grid" style="grid-template-columns: 1fr; gap: 8px; margin-top: 10px">
          <div>
            <label class="muted small">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="obj-desc" class="input" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–æ: —á—Ç–æ –∑–¥–µ—Å—å –∏ —á—Ç–æ –≤–∞–∂–Ω–æ"></textarea>
          </div>
          <div>
            <label class="muted small">–¢–µ–≥–∏/–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <input id="obj-tags" class="input" placeholder="–í–∏–¥–µ–æ–Ω–∞–±–ª—é–¥–µ–Ω–∏–µ, –î–æ–º–æ—Ñ–æ–Ω, ..." />
          </div>
        </div>

        <div style="margin-top: 12px">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:10px">
            <b>–ö–∞–º–µ—Ä—ã</b>
            <button id="obj-add-cam" class="btn" type="button" title="–î–æ–±–∞–≤–∏—Ç—å –∫–∞–º–µ—Ä—É">+ –ö–∞–º–µ—Ä–∞</button>
          </div>
          <div class="muted small" style="margin-top:4px">URL –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. Label –∏ type –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã.</div>
          <div id="obj-cameras" style="display:flex; flex-direction:column; gap:6px; margin-top:8px"></div>
        </div>

        <div class="actions" style="margin-top: 14px; display:flex; justify-content:space-between; gap:8px; flex-wrap:wrap">
          <button id="obj-delete" class="btn warn" type="button" style="display:none">–£–¥–∞–ª–∏—Ç—å</button>
          <div style="display:flex; gap:8px; margin-left:auto">
            <button id="obj-save" class="btn primary" type="button">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="{{ url_for('static', filename='js/csrf.js') }}"></script>
  <script src="{{ url_for('static', filename='js/realtime.js') }}"></script>
  <script src="{{ url_for('static', filename='js/i18n.js') }}"></script>
  <script src="{{ url_for('static', filename='js/recs.js') }}"></script>
  <script src="{{ url_for('static', filename='js/admin_panel.js') }}"></script>
  <script src="{{ url_for('static', filename='js/sidebar_tabs.js') }}"></script>
  <!-- –≠—Ç–∞–ø 1.1: —Å–ª–æ–π "–ò–Ω—Ü–∏–¥–µ–Ω—Ç—ã –Ω–∞ –∫–∞—Ä—Ç–µ" -->
  <script src="{{ url_for('static', filename='js/incidents_overlay.js') }}"></script>
  <script src="{{ url_for('static', filename='js/incidents_layer_toggle.js') }}"></script>
  <script src="{{ url_for('static', filename='js/incidents_panel_cc.js') }}"></script>

  <script src="{{ url_for('static', filename='js/incidents_ui.js') }}"></script>

  <!-- –≠—Ç–∞–ø 2.1: —Å–ª–æ–π "–û–±—ä–µ–∫—Ç—ã" + –º–æ–¥–∞–ª–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
  <script src="{{ url_for('static', filename='js/objects_overlay.js') }}"></script>
  <script src="{{ url_for('static', filename='js/objects_layer_toggle.js') }}"></script>
  <script src="{{ url_for('static', filename='js/objects_ui.js') }}"></script>
  <script src="{{ url_for('static', filename='js/objects_deeplink.js') }}"></script>
  <script src="{{ url_for('static', filename='js/objects_panel_cc.js') }}"></script>

  <script src="{{ url_for('static', filename='js/chat.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chat2.js') }}"></script>
  <script src="{{ url_for('static', filename='js/chat2_list.js') }}"></script>
  <script src="{{ url_for('static', filename='js/sos.js') }}"></script>
</body>
</html>