from __future__ import annotations

from app.ai.exploit_generator import ExploitGenerator


def test_generate_and_validate(monkeypatch):
    gen = ExploitGenerator()

    monkeypatch.setattr(gen.llm, "_call_llm", lambda prompt, max_tokens=700: "```python\nimport requests\nprint('ok')\n```")
    code = gen.generate_poc("CVE-X", "desc", "1.0")
    assert "import requests" in (code or "")
    res = gen.validate_exploit("CVE-X", code or "")
    assert res["syntax_valid"] is True
